function getTpl(e,t){return _.template($(e).html())(t)}"undefined"==typeof page_var&&(window.page_var={}),$(function(){$(window).resize();window.setTimeout(function(){console.log("yo")},1500)}),$(window).resize(function(){page_var.w_w=$(window).width(),page_var.w_h=$(window).height(),appState&&appState.render()});var AppState=Backbone.Model.extend({defaults:{stage:0,age:0,country:"",year:0},stage0:function(){var e=this,t=$(".b_form_basic").outerHeight(),a=(page_var.w_h-t)/2;$(".b_form_basic").css("top",a+"px").addClass("hide").removeClass("vishid").fadeIn(1e3),$(".b_form_basic form").on("submit",function(t){t.preventDefault();var a=$(this).serializeObject();e.set(a),e.set("stage",1)})},render:function(){var e=Math.floor(52*parseFloat(pageData.average[this.get("country")])),t=52*Math.floor(this.get("age")),a=t-e,i=$(".content-container").width(),r=$(".b_week_box > canvas")[0],n=r.getContext("2d");if(n){$(r).attr("width",i);var o={w:10,h:10,p:1};page_var.w_w<968&&(o={w:4,h:4,p:1});var s=o.w+o.p,l=o.h+o.p,h=0;h=0>=a?e:t;var f=Math.floor(i/s),_=Math.ceil(h/f);$(r).attr("height",_*l);for(var c=[0,0],w=0;h>w;w++){c[0]>=f&&(c[0]=0,c[1]++);var g={already:"#d56161",yet:"#666",over:"#008000"};n.fillStyle=0>=a?t>=w?g.already:g.yet:e>=w?g.already:g.over,n.fillRect(c[0]*s,c[1]*l,o.w,o.h),n.fillStyle==g.already&&page_var.w_w>968&&(n.font="12px Arial",n.fillStyle="#ffffff",n.fillText("x",c[0]*s+2,c[1]*l+9)),c[0]++}}else{for(var d=getTpl("#b_week_box__el",{win:!1}),p="",w=0;e-w>0;)p+=d,w++;if(a>0){d=getTpl("#b_week_box__el",{win:!0});for(var w=0;a-w>0;)p+=d,w++}$(".b_week_box").html(p),$(".b_week_box__el").slice(0,t).attr("data-already",!0);var u=pageData.countryNames[this.get("country")];"undefined"!=typeof u&&$(".b_chart .country_name").text(u)}0!=this.get("stage")&&$(".b_form_basic").fadeOut(300,function(){$(".b_chart").fadeIn(1500)})},stager:function(){switch(this.get("stage")){case 1:this.render();break;default:this.stage0()}},initialize:function(){console.log("init"),this.set("year",(new Date).getUTCFullYear()),$(window).resize(),this.stage0(),this.on("change:stage",this.stager)}}),appState=new AppState;$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};