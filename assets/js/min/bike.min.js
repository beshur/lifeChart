$(function(){pageData&&pageData.history&&Views.history.showHistory(pageData.history)}),$(window).resize(function(){Views.history.resize()});var HistoryPoint=Backbone.Model.extend({}),HistoryCol=Backbone.Collection.extend({model:HistoryPoint}),Bike=Backbone.View.extend({el:$(".b_bike"),events:{"click .b_bike_image .img":"position","click .b_parts":"position"},position:function(e){var t=$(e.currentTarget),i=e.offsetX,o=e.offsetY;"undefined"==typeof i&&(i=e.pageX),"undefined"==typeof o&&(o=e.pageY);var n=Math.round(i/t.width()*1e4)/100,s=Math.round(o/t.height()*1e4)/100,r={x:n,y:s};return console.log(r),r},initialize:function(){_.each(pageData.bike,function(e,t){if(console.log(t),e){if("string"==typeof e){var i=_.extend({item:e},pageData.bike.positions[t],{type:t});console.log(i);var o=getTpl("#b_parts__el",i);$(".b_parts").append(o)}}else console.log("ss")})}}),History=Backbone.View.extend({el:$(".b_history"),resize:function(){if(page_var.w_w>768){var e=$(".container-header > .navbar").outerHeight(),t=page_var.w_h-e,i=t+"px",o=this.$el.parent().width();this.$el.css({"max-height":i,height:t,width:o}),$(".b_bike").css({"max-height":i,height:t})}else this.$el.add(".b_bike").css({"max-height":"100%","min-height":0})},showHistory:function(e){var t=this;_.each(e,function(e){var i=getTpl("#b_history__el",e);t.$el.find(".b_history_list").prepend(i)})},events:function(){}}),HistoryForm=FormWidget.extend({el:$(".b_history_post"),events:{"click button":"beforeSubmit","keyup .input-text":"resizeInput"},beforeSubmit:function(e){console.log(e),e.preventDefault();var t=this.$el.find(".input-text").text();if(""!=t){this.$el.find(".input-text-real").val(t),this.$el.find(".input-text").text("").focus();var i={text:t,type:"post",image:pageData.user.image,time:moment().format("H:mm")};Views.history.showHistory([i])}},resizeInput:function(e){var t=$(e.currentTarget).height();this.$el.find("button").height(t)},resize:function(){this.$el.width()}});Views.bike=new Bike,Views.history=new History,Views.historyForm=new HistoryForm;